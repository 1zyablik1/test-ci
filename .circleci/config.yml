version: 2.1

jobs:
  build:
    environment:
      UNITY_USERNAME: your_unity_username
      UNITY_PASSWORD: your_unity_password
      ANDROID_HOME: C:\Android\sdk
      JAVA_HOME: C:\Program Files\Java\jdk1.8.0_251
      GRADLE_USER_HOME: C:\Users\circleci\.gradle
    working_directory: ~/project
    windows: true
    steps:
      - checkout
      - run: echo "y" | "$UNITY_PATH/Editor/Unity.exe" -quit -batchmode -username "$UNITY_USERNAME" -password "$UNITY_PASSWORD" -serial "$UNITY_SERIAL" -nographics -logFile "$UNITY_LOG_FILE"
      - run: echo "y" | "$UNITY_PATH/Editor/Unity.exe" -quit -batchmode -nographics -logFile "$UNITY_LOG_FILE" -projectPath "$UNITY_PROJECT_PATH" -executeMethod BuildScript.BuildAndroid
      - run: "$ANDROID_HOME/tools/bin/sdkmanager.bat \"build-tools;30.0.3\" \"platforms;android-30\""
      - run: Set-Content -Path 'C:\Users\circleci\.android\repositories.cfg' -Value '### User defined repositories path'
      - run: echo "sdk.dir=$ANDROID_HOME" > "$UNITY_PROJECT_PATH/LocalProperties.properties"
      - run: echo "Unity build complete"
      - store_artifacts:
          path: ~/repo/Builds
          destination: builds
workflows:
  build-test-deploy:
    jobs:
      - build