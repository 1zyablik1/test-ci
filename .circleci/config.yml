version: 2.1

jobs:
  build:
    macos:
      xcode: 12.5.1
    environment:
      UNITY_LICENSE: "UNITY_LICENSE_CONTENT"
    steps:
      - checkout
      - run:
          name: Install Unity Editor
          command: |
            mkdir -p ~/Unity
            cd ~/Unity
            curl -o Unity.pkg https://download.unity3d.com/download_unity/personal/Unity-2021.3.19f1.pkg
            sudo installer -dumplog -package Unity.pkg -target /
      - run:
          name: Build Unity Project
          command: |
            cd /path/to/unity/project
            /Applications/Unity/Unity.app/Contents/MacOS/Unity \
              -batchmode \
              -nographics \
              -quit \
              -projectPath . \
              -executeMethod BuildScript.PerformBuild \
              -logFile $(pwd)/unity.log
      - store_artifacts:
          path: /path/to/unity/project/Build
          destination: builds

workflows:
  build-only:
    jobs:
      - build
